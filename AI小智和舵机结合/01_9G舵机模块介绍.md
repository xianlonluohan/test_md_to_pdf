# 舵机

  舵机是伺服电机的一种，伺服电机就是带有反馈环节的电机，我们可以通过伺服电机进行精确的位置控制或者输出较高的扭矩。主要由**直流电机**、**减速齿轮组**、**传感器**以及**控制电路**共同构成。它能够根据接收到的信号，精确地将转轴旋转至预设的角度。舵机的旋转角度通常被限制在一定的范围内，例如180度，这是它与普通直流电机的主要区别。普通直流电机可以连续旋转，而舵机则只能在特定角度内进行转动。当然也存在360度舵机，但是360°舵机不是指它可以0~360°之间可以精确控制位置，是指它可以和与减速电机可以360°连续旋转，但控制方式有所不同，它不能够控制速度，只能正反转，停止三个控制信号。舵机型号多样，它们的体积和提供的力度各有差异。

舵机目前在航模、小型机器人等方向的应用非常广泛。

### 舵机分类

| 分类方式 |    名称    |                             描述                             |
| :------- | :--------: | :----------------------------------------------------------: |
| 控制电路 |  模拟舵机  | 控制电路为纯模拟电路，需要一直发送控制信号才能转到指定位置；响应速度慢； |
|          |  数字舵机  | 控制电路加入了微控制器，只需要发送一次目标信号即可到达指定位置；有信息反馈等功能； |
| 机械材质 | 塑料齿舵机 |    传动齿轮为塑料材质。舵机重量轻，价格便宜，但扭矩较小；    |
|          | 金属齿舵机 |     传动齿轮为金属材质。结实耐用，扭矩更大，但价格更贵；     |
| 控制接口 |  PWM舵机   |       传统航模控制方式，控制简单，MCU都可以产生控制；        |
|          |  总线舵机  | 集成式控制方式，支持信息反馈，控制信号有所优化，使用在控制精度高的场合； |

**本文档介绍的为模拟信号-PWM控制舵机**以及对舵机的相关知识点进行总结和分享，主要介绍舵机相关原理、以及驱动实现，如下为三款市面上最常见的pwm舵机，它们的工作原理都一致。

### SG90

![sg90](picture/sg90.png)

###

| 产品型号 | SG90                 |
| :------- | :------------------- |
| 尺寸     | 23x12.2x29mm         |
| 工作电压 | 3~6V                 |
| 重量     | 9 g                  |
| 工作扭矩 | 1.6 kg/cm (5V)       |
| 舵机类型 | 模拟舵机 pwm控制信号 |
| 齿轮类型 | 塑料齿轮             |
| 死区时间 | 5us                  |
| 反应速度 | 0.3 sec/60° (5 V)    |
| 转动角度 | 180°（左90°，右90°） |
| 接口类型 | XH2.54-3pin          |

### MG90S

![mg90](picture/mg90s.png)

| 产品型号 | MG90S                |
| :------- | :------------------- |
| 尺寸     | 22.8x12.2x28.5mm     |
| 工作电压 | 4.2~6V               |
| 重量     | 13.6 g               |
| 工作扭矩 | 2kg/cm (5V)          |
| 舵机类型 | 模拟舵机 pwm控制信号 |
| 齿轮类型 | 金属齿轮             |
| 反应速度 | 0.11 sec/60° (5 V)   |
| 转动角度 | 180°（左90°，右90°） |
| 接口类型 | XH2.54-3pin          |

### MG996

![mg996](picture/mg996.png)

| 产品型号 | MG996                |
| :------- | :------------------- |
| 尺寸     | 40.7x19.7x42.9mm     |
| 工作电压 | 4.2~7.2V             |
| 重量     | 55 g                 |
| 工作扭矩 | 13kg/cm (5V)         |
| 舵机类型 | 模拟舵机 pwm控制信号 |
| 齿轮类型 | 金属齿轮             |
| 反应速度 | 0.13 sec/60° (5 V)   |
| 转动角度 | 180°（左90°，右90°） |
| 接口类型 | XH2.54-3pin          |

### 舵机组成

舵机主要由几个部分组成：外壳、舵盘、直流电机、减速齿轮组、位置反馈器、控制电路等；结构示意图如下图所示:

![](picture/2.png)

### 舵机工作原理

​ 舵机内部的控制电路接收来自信号线的PWM控制脉冲，控制电机旋转，电机带动减速齿轮组，最后传动输出至舵盘，进而使舵机转动角度并保持。控制流程如下图所示：

![](picture/3.png)

- 舵机内部基准电路产生了周期为20ms、脉宽为1.5ms的基准信号，其体现为反馈基准电压Vref；

- 控制电路捕获外部PWM控制信号，经处理后输出一个直流偏置电压Vin；

- 将直流偏置电压Vin和反馈基准电压Vref进行比较，输出电压差；

- 电压差输出到电机驱动芯片驱动电机，其中电压差的正负决定电机的正反转，压差大小决定旋转的角度，电压差为0时，电机停止转动；

**特别注意**：采集的控制信号主要是脉冲的宽度，要使舵机输出轴角度发生变化，改变的是脉冲宽度（PWM控制时是控制占空比）。

### 驱动原理

舵机转动的角度与脉宽在0.5ms~2.5ms的区间内呈线性关系。舵机有90°、180°、270°、360°最大转角，这里以180°舵机为例来说明脉冲宽度和角度的关系，其他角度舵机参考具体参数，180°舵机周期为20ms时的脉宽和转角关系如下图：

![](picture/4.png)

| 脉冲宽度 | 转动角度 |
| :------: | :------: |
|  0.5ms   |   -90°   |
|   1ms    |   -45°   |
|  1.5ms   |    0°    |
|   2ms    |   45°    |
|  2.5ms   |   90°    |

### 舵机参数

|     参数      |                             描述                             |
| :-----------: | :----------------------------------------------------------: |
|    重量(g)    |                         舵机的总重量                         |
|   尺寸(mm)    |                        舵机的外形尺寸                        |
| 速度(sec/60°) |                    舵机转过60°所需的时间                     |
|    电压(V)    |                      舵机工作的电压范围                      |
|   电流电(A)   |                       舵机工作时的电流                       |
|    温度(℃)    |                      舵机工作的温度范围                      |
|   死区(us)    | 使舵机转动的最小脉冲宽度，低于该参数，舵机不转动； 停止角度的精确度，该数值越小，控制精度越高 |
|  扭矩(kg*cm)  | 舵机所能提供的最大扭矩。表示的是距离转动轴中心1cm处，舵机能够带动的重量![](picture/5.png) |

### SG90舵机实物连接线

​ 舵机的有3条输入线，线序颜色为：中间红色线为电源正极，棕色线为电源负极，黄色线为控制信号线，具体如下图所示。特别说明：不同的厂商制作的舵机的输入线颜色可能会存在不一致，但一般中间的线为红色正极，信号线可能为白色，负极可能为黑色，具体还是要参考舵机的数据手册。

![](picture/6.png)
![](picture/7.png)

## 用Arduino Uno控制舵机

### 硬件电路连线

| **Arduino Uno开发板引脚** | **舵机**  | **功能** |
| :-----------------------: | :-------: | :------: |
|            GND            | GND(棕色) |   负极   |
|            5V             | VCC(红色) |   正极   |
|             9             | PWM(橙色) | 信号输入 |

### Servo库常用函数

| **Servo库函数**  |                           **说明**                           |      **语法**      |                        **参数**                        |
| :--------------: | :----------------------------------------------------------: | :----------------: | :----------------------------------------------------: |
|  servo.attach()  |                  设置Arduino舵机的引脚连接                   | servo.attach(pin)  |           pin：连接舵机数据线的Arduino引脚号           |
|  servo.write()   | 控制舵机旋转；对于标准180°舵机，write()函数会将舵机轴旋转到相应的角度位置。 | servo.write(angle) | angle:旋转角度数值；对于标准180°舵机，angle范围为0~180 |
|   servo.read()   | 获取当前舵机轴角度信息（即上一次使用write()函数设置舵机轴的角度信息） |    servo.read()    |                          none                          |
| servo.attached() | 检查某一个舵机对象是否连接在开发板引脚上（如果连上，则返回true；否则返回false） |  servo.attached()  |                          none                          |
|  servo.detach()  | 将舵机对象与Arduino开发板断开连接。舵机一旦与Arduino开发板断开连接，则引脚9和引脚10PWM输出（analogWrite）功能将会恢复。 |   servo.detach()   |                          none                          |

## 实验

 示例代码实现舵机0~180°来回转动功能。

```c
#include <Servo.h>  //引用Servo库函数
Servo myservo;   //建立一个名为myservo的舵机
int angle;  //建立一个整形变量，储存舵机旋转角度
void setup() {
 myservo.attach(9);  //告诉arduino，舵机的信号线连在9号引脚上
 myservo.write(0);   //设置舵机的初始角度为0
 Serial.begin(9600);  //打开串口监视器，并设置波特率为9600
 Serial.println(myservo.attached());  //连上则返回1；
}
 
void loop() {
  for(angle=0;angle<=180;angle++){ //逆时针旋转，每增加1°，延迟15ms
    myservo.write(angle);  //令舵机达到angle的角度（当angle=100时，则舵机旋转到角度为10的位置）
    Serial.println(angle); //将此时的角度显示在串口监视器内
    delay(15);
  }
  for(angle=180;angle>=0;angle--){ //顺时针旋转，每增加1°，延迟15ms
    myservo.write(angle);
    Serial.println(angle);
    delay(15);
  }
}
```

### Mixly测试程序

![mixly_servo_test](picture/mixly_servo_test.png)

<a href="./resource/mixly_servo_test.zip" download>点击下载Mixly舵机测试程序</a>

### 仿真结果

![uno_servo_result](picture/uno_servo_result.gif)

## microbit Servo舵机使用

makecode自带servo库 [makeco servo使用链接](https://makecode.microbit.org/reference/servo)

## ESP32 Servo库

esp32主板的Arduino servo库和Arduino Uno主板使用的库不一样，请查看  [esp32 arduino ide servo库](https://github.com/emakefun-arduino-library/em_esp32_servo)

micropython库 [esp32 micropython库](https://github.com/redoxcode/micropython-servo)
